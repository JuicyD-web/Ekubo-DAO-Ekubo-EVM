name: License Compliance Check

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  schedule:
    - cron: '0 3 * * 1' # Runs every Monday at 03:00 UTC

jobs:
  compliance-check:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Check for license files
        run: |
          test -f LICENSE || (echo "LICENSE file missing!" && exit 1)
          test -f COPYRIGHT.md || (echo "COPYRIGHT.md file missing!" && exit 1)
          test -f THIRD_PARTY_LICENSES.md || (echo "THIRD_PARTY_LICENSES.md file missing!" && exit 1)

      - name: Scan for license headers in source files
        run: |
          grep -r "Ekubo DAO Shared Revenue License" src/ || (echo "License header missing in source files!" && exit 1)

      - name: Upload compliance check results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: compliance-check-results
          path: .